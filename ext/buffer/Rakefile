require File.join(File.dirname(__FILE__), '..', '..', 'lib', 'coo-coo', 'platform')

NVCC = ENV.fetch("NVCC", "nvcc")
NVCCFLAGS = Array.new
NVCCFLAGS << "-g" if ENV['DEBUG']

if CooCoo::Platform.windows?
  #NVCCFLAGS="--cl-version=2015"
else
  NVCCFLAGS << "--compiler-options='-fPIC -Wall'"
end

DLEXT=RbConfig::CONFIG['DLEXT']

task :default => "buffer.#{DLEXT}"

task :clean do
  sh("rm -f buffer.#{DLEXT} buffer.ext buffer.lib")
end

desc "Build buffer.#{DLEXT}"
file "buffer.#{DLEXT}" => 'buffer.cu' do |t|
	sh("#{NVCC} #{NVCCFLAGS.join(' ')} -shared -o #{t.name} #{t.sources.join(' ')}")
end

